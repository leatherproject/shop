(()=>{"use strict";const e=document.getElementsByTagName("body")[0];function t(){e.style.overflowY="hidden"}function s(){e.style.overflowY="visible"}const o=document.querySelector(".social-mobile__base-icon"),n=document.querySelector(".social-mobile"),a=document.querySelectorAll(".social-mobile__link");function c(e){n.contains(e.target)||e.target===o||(a.forEach((e=>e.classList.remove("icons-show"))),o.classList.remove("base-icon-hidden"),document.removeEventListener("click",c))}function r(){const e="swiper-modal__layer",o=".slide__img",n="layer-view",a="layer-hidden",c="filters",r=document.getElementsByClassName(e)[0],l=document.getElementsByClassName("for-effects");let i=function(){for(let e=0;e<l.length;e++)l[e].classList.remove(c)};const d=(r.style.animationDuration="0.3s",window.getComputedStyle(r).getPropertyValue("animation-duration"),300);function m(){let e;e=window.setTimeout((function(){r.classList.remove(a)}),d)}document.querySelectorAll(o).forEach((e=>{e.addEventListener("click",(e=>{let s=[...document.querySelectorAll(o)].indexOf(e.target);r.classList.add(n),function(){for(let e=0;e<l.length;e++)l[e].classList.add(c)}(),t(),p(u=s+1)}))})),document.addEventListener("click",(e=>{"swiper-modal__close far fa-times-circle"===e.target.className&&(r.classList.remove(n),r.classList.add(a),i(),s(),m())})),r.addEventListener("click",(function(){let t=event.target.className;event.target,t!==`${e} ${n}`&&""!==t||(r.classList.remove(n),r.classList.add(a),i(),s(),m())}));let u=1;function p(e){const t=document.getElementsByClassName("swiper-modal__image-box");let s;for(e>t.length&&(u=1),e<1&&(u=t.length),s=0;s<t.length;s++)t[s].style.display="none";t[u-1].style.display="block"}p(u)}o.addEventListener("click",(function(e){a.forEach((e=>e.classList.toggle("icons-show"))),o.classList.toggle("base-icon-hidden"),document.addEventListener("click",c)})),function(){const e=document.querySelector(".menu"),o=document.querySelector(".mobile-layer"),n=function(t){const s="0.4s";return e.style.animationDuration=s,o.style.animationDuration=s,window.getComputedStyle(e).getPropertyValue("animation-duration"),400}(),a=document.querySelector(".menu-btn"),c=document.querySelector(".menu-icon");function r(){let t;t=window.setTimeout((function(){e.classList.remove("menu-mobile"),o.classList.remove("mob-layer-off")}),n),a.addEventListener("click",(()=>{clearTimeout(t)}))}a.addEventListener("click",(e=>{!function(){c.classList.toggle("fa-times"),a.classList.add("stop-propagation");const e=document.querySelector(".menu"),o=c.classList.contains("fa-times"),n=document.querySelector(".mobile-layer");1==o?(e.classList.add("menu-mobile"),n.classList.add("mob-layer-on"),n.classList.remove("mob-layer-off"),t(),e.classList.add("menu-visible"),e.classList.remove("menu-hidden")):0==o&&(n.classList.add("mob-layer-off"),n.classList.remove("mob-layer-on"),s(),e.classList.remove("menu-visible"),e.classList.add("menu-hidden"),r()),document.addEventListener("click",(t=>{document.querySelector(".menu-btn");const o=t.target.classList.contains("stop-propagation"),a=document.querySelector(".menu-mobile"),l=c.classList.contains("fa-times");t.target.className,0!=o||1!=l||a.contains(t.target)||(c.classList.remove("fa-times"),n.classList.add("mob-layer-off"),n.classList.remove("mob-layer-on"),s(),e.classList.remove("menu-visible"),e.classList.add("menu-hidden"),r())}))}(),e.stopPropagation()}))}(),function(){const e=document.querySelector(".header"),t=document.querySelector(".social-mobile");let s=0;function o(){let o=window.pageYOffset;s>o?(e&&e.classList.remove("header--scroll"),0===o&&e&&e.classList.remove("header-scroll-bg"),t&&t.classList.remove("social-mob--scroll")):s<o&&(e&&e.classList.add("header--scroll"),t&&t.classList.add("social-mob--scroll"),o>0&&e&&e.classList.add("header-scroll-bg")),s=o}try{o(),window.onscroll=o}catch(e){console.error("Error initializing scrollingX:",e)}}();try{null!==document.getElementById("sliderSwiper")&&new Swiper(".swiper",{breakpoints:{320:{slidesPerView:1.3,spaceBetween:10},480:{slidesPerView:2,spaceBetween:10},640:{slidesPerView:2.3,spaceBetween:10},867:{slidesPerView:3,spaceBetween:10},1100:{slidesPerView:3,spaceBetween:45}},pagination:{el:".swiper-pagination",clickable:!0},navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"}})}catch(e){}function l(e){e.querySelectorAll(".js-accordion-toggle").forEach((e=>{e.addEventListener("click",(()=>{e.classList.toggle("active");const t=e.closest(".faq__item").querySelector(".faq__answer");t.style.maxHeight?(t.style.maxHeight=null,t.classList.remove("js-open-style")):(t.style.maxHeight=t.scrollHeight+"px",t.classList.add("js-open-style"))}))}))}window.colorMap={чёрный:"#000000",черный:"#000000","чёрный/охра":"#000000",коричневый:"#8B4513","коричневый/коньяк":"#8B4513",белый:"#FFFFFF",бежевый:"#F5F5DC","бордово-коричневый":"#8B3A3A",шоколадный:"#442D25","светло-коричневый":"#8c624a","тёмно-коричневый":"#472b1d",коньяк:"#b06010","коньяк/бежевый":"#b06010","серо-оливковый":"#A2B17D",рыжий:"#FF7518",песочный:"#dbb684",охра:"#9b562c","тёмно-каштановый":"#552F26",вишнёвый:"#9c0327",бордовый:"#751634","тёмно-бордовый":"#541026",синий:"#0000FF",зелёный:"#008000",серый:"#808080"};const i=document.querySelector(".articles-container"),d=document.querySelector(".faq-container--care"),m=document.querySelector(".faq-container--process"),u=(document.getElementById("modal-container"),document.querySelector(".swiper-wrapper")),p=document.querySelector(".swiper-modal__layer");function g(e,t){t.forEach((t=>{const s=document.createElement("div");s.classList.add("faq__item",`faq__item--${t.group}`),s.innerHTML=`     \n        <h3 class="faq__question faq__question--${t.group} js-accordion-toggle">\n          <button class="faq__toggle faq__toggle--${t.group}">${t.question}</button>\n        </h3>\n        <div class="faq__answer faq__answer--${t.group} js-accordion-panel">\n          <p class="faq__answer-text faq__answer-text--${t.group}">${t.answer}</p>\n        </div>      \n    `,e.appendChild(s)}))}function f(e){const t="string"==typeof e?parseFloat(e.replace(/[^\d.,]/g,"").replace(",",".")):e;return new Intl.NumberFormat("uk-UA",{style:"currency",currency:"UAH",minimumFractionDigits:0,maximumFractionDigits:2}).format(t)}!async function(e){try{i.innerHTML='<p class="loading">Loading...</p>',u.innerHTML='<p class="loading">Загрузка слайдера...</p>',d.innerHTML='<p class="loading">Care...</p>',m.innerHTML='<p class="loading">Process...</p>';const t=await fetch(e,{cache:"no-cache"});if(!t.ok)throw new Error("500 Internal Server Error");let s;try{s=await t.json()}catch(e){throw console.error("JSON parse error:",e),new Error("500 Internal Server Error")}const o=s.data;console.log("Полученные данные:",o);const n=o.filter((e=>"workshop"===e.page)),a=n.filter((e=>"faq"===e.type&&"care"===e.group)),c=n.filter((e=>"faq"===e.type&&"process"===e.group)),f=n.filter((e=>"articles"===e.type)),v=n.filter((e=>"slider"===e.type)),_=s.data.filter((e=>"ourProducts"===e.page&&!0===e.new));if(_.length>0){const e=document.querySelector(".js-mark");e.classList.add("is-visible"),e.textContent=`${_.length} new`,console.log(`Новых товаров: ${_.length}`)}i.innerHTML="",u.innerHTML="",d.innerHTML="",m.innerHTML="",f&&f.length>0?function(e){e.forEach(((e,t)=>{const s=document.createElement("div");s.classList.add("article",`article--${e.group}`);let o="";e.image&&(o=`<img class="article__image article__image--${e.group}" src="${e.image}" alt="${e.alt||""}">`);let n="",a=[];(e.text||"...").split("\n").forEach((t=>{let s=t.trimEnd().replace(/^\s+/,"");s.startsWith("-")?a.push(`<li class="article__list article__list--${e.group}">${s.substring(1).trim()}</li>`):(a.length&&(n+=`<ul class="article__ul article__ul--${e.group}">${a.join("")}</ul>`,a=[]),s&&(n+=`<p class="article__text article__text--${e.group}">${s}</p>`))})),a.length&&(n+=`<ul class="article__ul article__ul--${e.group}">${a.join("")}</ul>`),s.innerHTML=`\n      ${o}      \n      <h3 class="article__title article__title--${e.group}">${e.title||"..."}</h3>            \n      ${n}\n    `,i.appendChild(s)}))}(f):i.innerHTML='<p class="not-found">Нет статей</p>',a&&a.length>0?g(d,a):d.innerHTML='<p class="not-found">Пусто</p>',c&&c.length>0?g(m,c):m.innerHTML='<p class="not-found">Empty</p>',l(d),l(m),v&&v.length>0?function(e){e.forEach((e=>{const t=document.createElement("div");t.classList.add("swiper-slide","slide","slide--swiper"),t.innerHTML=`<img class="slide__img" src="${e.preview}" alt="${e.alt}" data-modal="${e.imageModal}">`,u.appendChild(t)})),e.forEach((e=>{const t=document.createElement("div");t.classList.add("swiper-modal__image-box"),t.innerHTML=`\n      <span class="swiper-modal__close far fa-times-circle"></span>\n      <img class="swiper-modal__image" src="${e.imageModal}" alt="${e.alt}">\n    `,p.appendChild(t),r?r():console.error("Ошибка: initLightbox не найден.")}))}(v):u.innerHTML='<p class="not-found">Нет изображений</p>'}catch(e){console.error("Fetch error:",e),i.innerHTML=`<p class="error-500">${e.message}</p>`,u.innerHTML=`<p class="error-500">${e.message}</p>`,d.innerHTML=`<p class="error-500">${e.message}</p>`,m.innerHTML=`<p class="error-500">${e.message}</p>`}}(window.AppConfig.API_URL);const v=document.querySelector(".cart-btn"),_=document.getElementById("cartOverlay"),y=document.querySelector(".cart-panel__close-btn"),L=document.querySelector(".cart-panel");function b(){L.classList.remove("cart-visible"),_.classList.remove("cart-overlay-view"),_.classList.add("cart-overlay-hide"),s()}function h(e){const t=document.createElement("div");t.className="cart-item",t.dataset.model=e.model,t.innerHTML=`\n    <button class="btn-remove fas fa-trash-alt" data-model="${e.model}"></button>\n    <img class="preview" src="${e.preview}" alt="${e.name}">\n    <p class="model">${e.model}</p>\n    <p class="name">${e.name}</p>\n    <p class="price">${f(e.price)}</p>\n    <p class="cart-item__info-type">Количество</p>\n    <div class="cart-item__controls">\n      <button class="cart-item__minus-btn js-minus" data-model="${e.model}">&minus;</button>\n      <span class="cart-item__qty js-qty">${e.count}</span>\n      <button class="cart-item__plus-btn js-plus" data-model="${e.model}">&plus;</button>\n    </div>\n    <div class="cart-item__option-colors">\n      <p class="cart-item__info-type">Colors</p>\n      <div class="cart-item__option-wrapper cart-item__option-wrapper--colors">\n        <span class="cart-item__info-color">${e.color1}</span> \n        <span class="cart-item__info-color">${e.color2}</span> \n        <span class="cart-item__info-color">${e.color3}</span> \n        <span class="cart-item__info-color">${e.color4}</span> \n      </div>\n    </div>\n    <div class="cart-item__option-size">\n      <p class="cart-item__info-type">Ширина ремня</p>\n      <div class="cart-item__option-wrapper cart-item__option-wrapper--size">\n        <span class="cart-item__info-size">${e.width1}</span> \n        <span class="cart-item__info-size">${e.width2}</span> \n        <span class="cart-item__info-size">${e.width3}</span> \n        <span class="cart-item__info-size">${e.width4}</span> \n      </div>\n    </div>\n    <div class="cart-item__option-customized">\n      <label class="cart-item__customized-label" for="waist">Обхват талии (см)\n        <span class="cart-item__customized-result"></span>\n      </label>\n      <input class="cart-item__customized-input" type="number" step="0.1" id="waist" name="waist" min="30" max="200" required>\n      <button class="cart-item__customized-btn js-customized-set">ok</button>\n    </div>\n  `,document.querySelector(".js-cart").appendChild(t);const s=window.colorMap||{};t.querySelectorAll(".cart-item__info-color").forEach((t=>{const o=t.textContent.trim().toLowerCase(),n=s[o];n?(t.style.backgroundColor=n,t.textContent=o):(t.classList.add("cart-item__info-color--undefined"),t.textContent=""),e.selectedColor&&e.selectedColor.toLowerCase()===o&&t.classList.add("color--selected")}));const o="belt"===e.category;console.log(o,e.category);const n=t.querySelector(".cart-item__option-size");o||n.classList.add("cart-item__option-size--hidden"),t.querySelectorAll(".cart-item__info-size").forEach((t=>{const s=t.textContent.trim().toLowerCase();"undefined"!==s?t.textContent=s:t.classList.add("cart-item__info-size--undefined"),e.selectedWidth&&e.selectedWidth.toLowerCase()===s&&t.classList.add("size--selected")}));const a=t.querySelector(".cart-item__customized-result"),c=t.querySelector(".cart-item__option-customized");console.log(o,e.category),o?a.textContent=e.customizedValue||"":c.classList.add("cart-item__option-customized--undefined");const r=t.querySelector(".js-plus"),l=t.querySelector(".js-minus"),i=void 0===e.limit||isNaN(e.limit);1===e.limit&&(r.disabled=!0,l.disabled=!0,r.classList.add("disabled-btn"),l.classList.add("disabled-btn")),e.count===e.limit&&(r.disabled=!0,r.classList.add("disabled-btn")),i&&(r.disabled=!0,l.disabled=!0,r.classList.add("disabled-btn"),l.classList.add("disabled-btn"))}v.addEventListener("click",(()=>{L.classList.toggle("cart-visible")?(_.classList.remove("cart-overlay-hide"),_.classList.add("cart-overlay-view"),t()):(_.classList.remove("cart-overlay-view"),_.classList.add("cart-overlay-hide"),s())})),_.addEventListener("click",b),y.addEventListener("click",b);const w=document.querySelector(".js-cart"),S=JSON.parse(localStorage.getItem("cart")||"[]");console.log(S),S.forEach(h),E();const q=document.querySelector(".count-badge");function E(){const e=document.querySelector(".cart-icon__count"),t=document.querySelector(".price-total");let s=0,o=0;S.forEach((e=>{s+=e.count,o+=e.count*e.price})),e.textContent=s,t.textContent=`Сумма: ${f(o)}`,console.log(s),console.log(o)}function $(){_.addEventListener("click",b),document.querySelector(".form-overlay").classList.remove("form-overlay-view"),document.querySelector(".form-overlay").classList.add("form-overlay-hide"),document.querySelector(".cart-panel").style.overflowY="visible"}S.length>0&&q.classList.add("count-badge--visible"),E(),w.addEventListener("click",(function(e){const t=e.target.closest(".cart-item__info-color");if(t){const e=t.closest(".cart-item"),s=e.dataset.model,o=S.find((e=>e.model===s));if(!o)return;const n=t.textContent.trim().toLowerCase();return e.querySelectorAll(".cart-item__info-color").forEach((e=>e.classList.remove("color--selected"))),t.classList.add("color--selected"),o.selectedColor=n,localStorage.setItem("cart",JSON.stringify(S)),void console.log(`Выбран цвет для ${s}: ${n}`)}const s=e.target.closest(".cart-item__info-size");if(s){const e=s.closest(".cart-item"),t=e.dataset.model,o=S.find((e=>e.model===t));if(!o)return;const n=s.textContent.trim().toLowerCase();return e.querySelectorAll(".cart-item__info-size").forEach((e=>e.classList.remove("size--selected"))),s.classList.add("size--selected"),o.selectedWidth=n,localStorage.setItem("cart",JSON.stringify(S)),void console.log(`Выбран размер для ${t}: ${n}`)}const o=e.target.dataset.model;if(!o)return;const n=S.find((e=>e.model===o));if(!n)return;const a=document.querySelector(`.cart-item[data-model="${o}"]`),c=a.querySelector(".js-qty");if(e.target.classList.contains("btn-remove")){S.splice(S.indexOf(n),1),a?.remove(),localStorage.setItem("cart",JSON.stringify(S));const e=document.querySelector(`.js-add-cart[data-id="${o}"]`);return e&&(e.disabled=!1,e.textContent="добавить",e.classList.remove("ordered")),!S.length>0&&q.classList.remove("count-badge--visible"),void E()}const r=a.querySelector(".js-plus"),l=a.querySelector(".js-minus"),i=void 0===n.limit||isNaN(n.limit);e.target.classList.contains("js-plus")?!i&&n.count<n.limit&&n.count++:e.target.classList.contains("js-minus")&&n.count>1&&n.count--,c&&(c.textContent=`${n.count}`),r.disabled=!i&&n.count>=n.limit,l.disabled=n.count<=1,r.classList.toggle("disabled-btn",r.disabled),l.classList.toggle("disabled-btn",l.disabled),i&&(r.classList.add("disabled-btn",r.disabled),l.classList.add("disabled-btn",l.disabled)),localStorage.setItem("cart",JSON.stringify(S)),E()})),w.addEventListener("click",(function(e){if(e.target.classList.contains("js-customized-set")){const t=e.target.closest(".cart-item"),s=t.querySelector(".cart-item__customized-input"),o=t.querySelector(".cart-item__customized-result");if(s.value=s.value.replace(",","."),console.log(s.value),o.value=s.value,!s.checkValidity())return void s.reportValidity();s.classList.remove("input--error");const n=t.dataset.model,a=S.find((e=>e.model===n));if(!a)return;const c=parseFloat(s.value.trim());o.textContent=c,s.value="",a.customizedValue=c,localStorage.setItem("cart",JSON.stringify(S)),console.log(`Талия обновлена: ${n} — ${c} см`)}})),document.querySelector(".js-clear-all").addEventListener("click",(()=>{localStorage.removeItem("cart"),S.length=0,w.innerHTML="",q.classList.remove("count-badge--visible"),E(),document.querySelectorAll(".js-add-cart").forEach((e=>{e.disabled=!1,e.textContent="добавить",e.classList.remove("ordered")}))})),document.getElementById("openOrderBtn").addEventListener("click",(()=>{const e=JSON.parse(localStorage.getItem("cart")||"[]"),t=document.querySelector(".js-order-warning");if(0===e.length)return t.textContent="Корзина пуста!",setTimeout((function(){t.textContent=""}),2200),void console.log("Корзина пуста!");for(const t of e)if("belt"===t.category){const e=t.customizedValue,s=Number(e);if(!e||isNaN(s)){const e=document.querySelector(`.cart-item[data-model="${t.model}"]`)?.querySelector(".cart-item__customized-input");return void(e?(e.reportValidity(),e.classList.add("input--error")):console.warn(`Поле талии не найдено для модели ${t.model}`))}}_.removeEventListener("click",b),document.querySelector(".form-overlay").classList.add("form-overlay-view"),document.querySelector(".form-overlay").classList.remove("form-overlay-hide"),document.querySelector(".cart-panel").style.overflowY="hidden"})),document.getElementById("closeOrderBtn").addEventListener("click",(()=>{$()}));const C=document.getElementById("orderForm"),x=document.getElementById("phoneInput"),k=document.getElementById("phoneError"),j=document.getElementById("formAgreement");j.addEventListener("change",(()=>{j.checked&&j.classList.remove("input--error")})),C.addEventListener("submit",(e=>{e.preventDefault();const s=x.value.trim();if(k.textContent="",x.classList.remove("input--error"),j.classList.remove("input--error"),!/^\+380\d{9}$/.test(s))return k.textContent="Введите номер в формате +380XXXXXXXXX",x.classList.add("input--error"),void x.focus();if(!j.checked)return j.classList.add("input--error"),void j.focus();console.log(j.checked);const o=JSON.parse(localStorage.getItem("cart"))||[];document.getElementById("modalMessage").textContent="Отправка заказа...",document.querySelector(".cart__dialog-overlay").classList.remove("c-dialog-hide"),document.querySelector(".cart__dialog-overlay").classList.add("c-dialog-view"),t(),C.phone.value=s,C.cart.value=JSON.stringify(o),C.secret.value="k5Dvofjh5670OjhHqErg490dbd54hHkjkdfOo0m",C.action="https://script.google.com/macros/s/AKfycbwDRQn2kc9IH5Kour4Do2lSMqMlwEBQzxjuOMGjir1XIrtCvAcoBn0M27qMoL3xuQ/exec",C.method="POST",C.target="hidden_iframe",console.log(C.secret.value),C.submit()})),document.getElementById("hidden_iframe").addEventListener("load",(()=>{console.log("Ответ от GAS получен — очищаем интерфейс"),localStorage.removeItem("cart"),S.length=0,w.innerHTML="",q.classList.remove("count-badge--visible"),E(),document.querySelectorAll(".js-add-cart").forEach((e=>{e.disabled=!1,e.textContent="добавить",e.classList.remove("ordered")})),x.value="",s(),document.querySelector(".cart__dialog-overlay").classList.remove("c-dialog-view"),document.querySelector(".cart__dialog-overlay").classList.add("c-dialog-hide"),$()})),window.addEventListener("pageshow",(e=>{if(!e.persisted)return;const t=JSON.parse(localStorage.getItem("cart")||"[]");S.length=0,S.push(...t),w.innerHTML="",t.forEach(h),E(),!S.length>0&&q.classList.remove("count-badge--visible"),document.querySelectorAll(".js-add-cart").forEach((e=>{const s=t.some((t=>t.model===e.dataset.id));e.disabled=s,e.textContent=s?"В корзине":"добавить",s||e.classList.remove("ordered")}))}))})();