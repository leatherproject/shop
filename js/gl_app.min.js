(()=>{"use strict";const e=document.getElementsByTagName("body")[0];function t(){e.style.overflowY="hidden"}function o(){e.style.overflowY="visible"}const s=document.querySelector(".social-mobile__base-icon"),a=document.querySelector(".social-mobile"),n=document.querySelectorAll(".social-mobile__link");function c(e){a.contains(e.target)||e.target===s||(n.forEach((e=>e.classList.remove("icons-show"))),s.classList.remove("base-icon-hidden"),document.removeEventListener("click",c))}function l(){const e="swiper-modal__layer",s=".slide__img",a="layer-view",n="layer-hidden",c="filters",l=document.getElementsByClassName(e)[0],i=document.getElementsByClassName("for-effects");let r=function(){for(let e=0;e<i.length;e++)i[e].classList.remove(c)};const d=(l.style.animationDuration="0.3s",window.getComputedStyle(l).getPropertyValue("animation-duration"),300);function m(){let e;e=window.setTimeout((function(){l.classList.remove(n)}),d)}document.querySelectorAll(s).forEach((e=>{e.addEventListener("click",(e=>{let o=[...document.querySelectorAll(s)].indexOf(e.target);l.classList.add(a),function(){for(let e=0;e<i.length;e++)i[e].classList.add(c)}(),t(),p(u=o+1)}))})),document.addEventListener("click",(e=>{"swiper-modal__close far fa-times-circle"===e.target.className&&(l.classList.remove(a),l.classList.add(n),r(),o(),m())})),l.addEventListener("click",(function(){let t=event.target.className;event.target,t!==`${e} ${a}`&&""!==t||(l.classList.remove(a),l.classList.add(n),r(),o(),m())}));let u=1;function p(e){const t=document.getElementsByClassName("swiper-modal__image-box");let o;for(e>t.length&&(u=1),e<1&&(u=t.length),o=0;o<t.length;o++)t[o].style.display="none";t[u-1].style.display="block"}p(u)}s.addEventListener("click",(function(e){n.forEach((e=>e.classList.toggle("icons-show"))),s.classList.toggle("base-icon-hidden"),document.addEventListener("click",c)})),function(){const e=document.querySelector(".menu"),s=document.querySelector(".mobile-layer"),a=function(t){const o="0.4s";return e.style.animationDuration=o,s.style.animationDuration=o,window.getComputedStyle(e).getPropertyValue("animation-duration"),400}(),n=document.querySelector(".menu-btn"),c=document.querySelector(".menu-icon");function l(){let t;t=window.setTimeout((function(){e.classList.remove("menu-mobile"),s.classList.remove("mob-layer-off")}),a),n.addEventListener("click",(()=>{clearTimeout(t)}))}n.addEventListener("click",(e=>{!function(){c.classList.toggle("fa-times"),n.classList.add("stop-propagation");const e=document.querySelector(".menu"),s=c.classList.contains("fa-times"),a=document.querySelector(".mobile-layer");1==s?(e.classList.add("menu-mobile"),a.classList.add("mob-layer-on"),a.classList.remove("mob-layer-off"),t(),e.classList.add("menu-visible"),e.classList.remove("menu-hidden")):0==s&&(a.classList.add("mob-layer-off"),a.classList.remove("mob-layer-on"),o(),e.classList.remove("menu-visible"),e.classList.add("menu-hidden"),l()),document.addEventListener("click",(t=>{document.querySelector(".menu-btn");const s=t.target.classList.contains("stop-propagation"),n=document.querySelector(".menu-mobile"),i=c.classList.contains("fa-times");t.target.className,0!=s||1!=i||n.contains(t.target)||(c.classList.remove("fa-times"),a.classList.add("mob-layer-off"),a.classList.remove("mob-layer-on"),o(),e.classList.remove("menu-visible"),e.classList.add("menu-hidden"),l())}))}(),e.stopPropagation()}))}(),function(){const e=document.querySelector(".header"),t=document.querySelector(".social-mobile");let o=0;function s(){let s=window.pageYOffset;o>s?(e&&e.classList.remove("header--scroll"),0===s&&e&&e.classList.remove("header-scroll-bg"),t&&t.classList.remove("social-mob--scroll")):o<s&&(e&&e.classList.add("header--scroll"),t&&t.classList.add("social-mob--scroll"),s>0&&e&&e.classList.add("header-scroll-bg")),o=s}try{s(),window.onscroll=s}catch(e){console.error("Error initializing scrollingX:",e)}}();try{null!==document.getElementById("sliderSwiper")&&new Swiper(".swiper",{breakpoints:{320:{slidesPerView:1.3,spaceBetween:10},480:{slidesPerView:2,spaceBetween:10},640:{slidesPerView:2.3,spaceBetween:10},867:{slidesPerView:3,spaceBetween:10},1100:{slidesPerView:3,spaceBetween:45}},pagination:{el:".swiper-pagination",clickable:!0},navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"}})}catch(e){}window.colorMap={чёрный:"#000000",черный:"#000000","чёрный/охра":"#000000",коричневый:"#8B4513","коричневый/коньяк":"#8B4513",белый:"#FFFFFF",бежевый:"#F5F5DC","бордово-коричневый":"#8B3A3A",шоколадный:"#442D25","светло-коричневый":"#8c624a","тёмно-коричневый":"#472b1d",коньяк:"#b06010","коньяк/бежевый":"#b06010","серо-оливковый":"#A2B17D",рыжий:"#FF7518",песочный:"#dbb684",охра:"#9b562c","тёмно-каштановый":"#552F26",вишнёвый:"#9c0327",бордовый:"#751634","тёмно-бордовый":"#541026",синий:"#0000FF",зелёный:"#008000",серый:"#808080"};const i=document.querySelector(".gallery-flex-container"),r=document.getElementById("modal-container"),d=document.querySelector("[data-top-image]"),m=document.querySelector("[data-top-title]"),u=document.querySelector("[data-top-slogan]"),p=document.querySelector("[data-top-offer]"),g=document.querySelector(".swiper-wrapper"),y=document.querySelector(".swiper-modal__layer"),v=window.AppConfig.API_URL;!async function(){try{i.innerHTML='<p class="loading">Loading...</p>',g.innerHTML='<p class="loading">Загрузка слайдера...</p>';const e=await fetch(v);if(!e.ok)throw new Error("500 Internal Server Error");let t;try{t=await e.json()}catch(e){throw console.error("JSON parse error:",e),new Error("500 Internal Server Error")}const o=(t.data||[]).filter((e=>"gallery"===e.page&&"pictures"===e.type)),s=(t.data||[]).filter((e=>"gallery"===e.page&&"slider"===e.type)),a=t.data.filter((e=>"ourProducts"===e.page&&!0===e.new));if(a.length>0){const e=document.querySelector(".js-mark");e.classList.add("is-visible"),e.textContent=`${a.length} new`,console.log(`Новых товаров: ${a.length}`)}i.innerHTML="",g.innerHTML="";const n=(t.data||[]).filter((e=>"gallery"===e.page&&"top"===e.type));d.style.backgroundImage=`url(${n[0].image})`,m.textContent=n[0].title,u.textContent=n[0].slogan,p.firstChild.textContent=n[0].offer,p.querySelector("a").textContent=n[0].link,o&&o.length>0?function(e){e.forEach((e=>{const t=document.createElement("div");t.classList.add("gallery"),t.innerHTML=`\n      <img src="${e.preview}" class="gallery__img" alt="${e.alt}">\n      <div class="gallery__info">\n        <h3 class="gallery__caption">${e.caption}</h3>\n      </div>\n    `,t.querySelector(".gallery__img").onerror=function(){this.src="img/preview/image-not-found-v-bg.png",this.alt="Изображение не найдено",console.warn(`Не удалось загрузить изображение: ${e.preview}`)},t.addEventListener("click",(()=>_(e))),i.appendChild(t)}))}(o):i.innerHTML='<p class="not-found">Товары не найдены</p>',s&&s.length>0?function(e){e.forEach((e=>{const t=document.createElement("div");t.classList.add("swiper-slide","slide","slide--swiper"),t.innerHTML=`\n      <img class="slide__img" src="${e.preview}" alt="${e.alt}" data-modal="${e.imageModal}">\n    `,g.appendChild(t)})),e.forEach((e=>{const t=document.createElement("div");t.classList.add("swiper-modal__image-box"),t.innerHTML=`\n      <span class="swiper-modal__close far fa-times-circle"></span>\n      <img class="swiper-modal__image" src="${e.imageModal}" alt="${e.alt}">\n    `,y.appendChild(t),l?l():console.error("Ошибка: initLightbox не найден.")}))}(s):g.innerHTML='<p class="not-found">Нет изображений</p>'}catch(e){console.error("Fetch error:",e),i.innerHTML=`<p class="error-500">${e.message}</p>`,g.innerHTML=`<p class="error-500">${e.message}</p>`}}();const f={},L=document.createElement("div");L.classList.add("modal","modal--lightbox"),r.appendChild(L);const _=async e=>{L.innerHTML=`\n    <div class="modal-content modal-content--lightbox">\n      <p class="loading-message"></p>\n      <img data-src="${e.imageModal}" class="modal-img" data-alt="${e.alt}">\n      <span class="close far fa-times-circle"></span>\n    </div>\n  `,L.classList.add("modal-view"),L.classList.remove("modal-hide"),t();const s=L.querySelector(".modal-img"),a=L.querySelector(".loading-message"),n=await(async e=>{if(void 0!==f[e])return f[e];try{const t=L.querySelector(".loading-message");t.textContent="Поиск изображения...",t.classList.add("loading-message");const o=await fetch(e,{method:"HEAD"});return f[e]=o.ok,o.ok}catch(e){return console.error("Ошибка сети:",e),null}})(e.imageModal);setTimeout((function(){!0===n?(a.textContent="Загрузка...",a.classList.add("loading-message"),s.onload=()=>{a.classList.remove("loading-message"),a.remove()},setTimeout((function(){s.src=s.dataset.src,s.alt=s.dataset.alt}),1500)):!1===n?(a.remove(),s.src="/img/preview/image-not-found-v.png",s.alt="Изображение не найдено",s.style.boxShadow="0 0 0 0 rgba(0, 0, 0, 0.3)"):a.textContent="Ошибка сети",L.querySelector(".close").addEventListener("click",(()=>{L.classList.remove("modal-view"),L.classList.add("modal-hide"),o()}))}),1500)};function b(e){const t="string"==typeof e?parseFloat(e.replace(/[^\d.,]/g,"").replace(",",".")):e;return new Intl.NumberFormat("uk-UA",{style:"currency",currency:"UAH",minimumFractionDigits:0,maximumFractionDigits:2}).format(t)}L.addEventListener("click",(e=>{e.target===L&&(L.classList.remove("modal-view"),L.classList.add("modal-hide"),o())}));const w=document.querySelector(".cart-btn"),h=document.getElementById("cartOverlay"),S=document.querySelector(".cart-panel__close-btn"),E=document.querySelector(".cart-panel");function q(){E.classList.remove("cart-visible"),h.classList.remove("cart-overlay-view"),h.classList.add("cart-overlay-hide"),o()}function C(e){const t=document.createElement("div");t.className="cart-item",t.dataset.model=e.model,t.innerHTML=`\n    <button class="btn-remove fas fa-trash-alt" data-model="${e.model}"></button>\n    <img class="preview" src="${e.preview}" alt="${e.name}">\n    <p class="model">${e.model}</p>\n    <p class="name">${e.name}</p>\n    <p class="price">${b(e.price)}</p>\n    <p class="cart-item__info-type">Количество</p>\n    <div class="cart-item__controls">\n      <button class="cart-item__minus-btn js-minus" data-model="${e.model}">&minus;</button>\n      <span class="cart-item__qty js-qty">${e.count}</span>\n      <button class="cart-item__plus-btn js-plus" data-model="${e.model}">&plus;</button>\n    </div>\n    <div class="cart-item__option-colors">\n      <p class="cart-item__info-type">Colors</p>\n      <div class="cart-item__option-wrapper cart-item__option-wrapper--colors">\n        <span class="cart-item__info-color">${e.color1}</span> \n        <span class="cart-item__info-color">${e.color2}</span> \n        <span class="cart-item__info-color">${e.color3}</span> \n        <span class="cart-item__info-color">${e.color4}</span> \n      </div>\n    </div>\n    <div class="cart-item__option-size">\n      <p class="cart-item__info-type">Ширина ремня</p>\n      <div class="cart-item__option-wrapper cart-item__option-wrapper--size">\n        <span class="cart-item__info-size">${e.width1}</span> \n        <span class="cart-item__info-size">${e.width2}</span> \n        <span class="cart-item__info-size">${e.width3}</span> \n        <span class="cart-item__info-size">${e.width4}</span> \n      </div>\n    </div>\n    <div class="cart-item__option-customized">\n      <label class="cart-item__customized-label" for="waist">Обхват талии (см)\n        <span class="cart-item__customized-result"></span>\n      </label>\n      <input class="cart-item__customized-input" type="number" step="0.1" id="waist" name="waist" min="30" max="200" required>\n      <button class="cart-item__customized-btn js-customized-set">ok</button>\n    </div>\n  `,document.querySelector(".js-cart").appendChild(t);const o=window.colorMap||{};t.querySelectorAll(".cart-item__info-color").forEach((t=>{const s=t.textContent.trim().toLowerCase(),a=o[s];a?(t.style.backgroundColor=a,t.textContent=s):(t.classList.add("cart-item__info-color--undefined"),t.textContent=""),e.selectedColor&&e.selectedColor.toLowerCase()===s&&t.classList.add("color--selected")}));const s="belt"===e.category;console.log(s,e.category);const a=t.querySelector(".cart-item__option-size");s||a.classList.add("cart-item__option-size--hidden"),t.querySelectorAll(".cart-item__info-size").forEach((t=>{const o=t.textContent.trim().toLowerCase();"undefined"!==o?t.textContent=o:t.classList.add("cart-item__info-size--undefined"),e.selectedWidth&&e.selectedWidth.toLowerCase()===o&&t.classList.add("size--selected")}));const n=t.querySelector(".cart-item__customized-result"),c=t.querySelector(".cart-item__option-customized");console.log(s,e.category),s?n.textContent=e.customizedValue||"":c.classList.add("cart-item__option-customized--undefined");const l=t.querySelector(".js-plus"),i=t.querySelector(".js-minus"),r=void 0===e.limit||isNaN(e.limit);1===e.limit&&(l.disabled=!0,i.disabled=!0,l.classList.add("disabled-btn"),i.classList.add("disabled-btn")),e.count===e.limit&&(l.disabled=!0,l.classList.add("disabled-btn")),r&&(l.disabled=!0,i.disabled=!0,l.classList.add("disabled-btn"),i.classList.add("disabled-btn"))}w.addEventListener("click",(()=>{E.classList.toggle("cart-visible")?(h.classList.remove("cart-overlay-hide"),h.classList.add("cart-overlay-view"),t()):(h.classList.remove("cart-overlay-view"),h.classList.add("cart-overlay-hide"),o())})),h.addEventListener("click",q),S.addEventListener("click",q);const $=document.querySelector(".js-cart"),k=JSON.parse(localStorage.getItem("cart")||"[]");console.log(k),k.forEach(C),B();const x=document.querySelector(".count-badge");function B(){const e=document.querySelector(".cart-icon__count"),t=document.querySelector(".price-total");let o=0,s=0;k.forEach((e=>{o+=e.count,s+=e.count*e.price})),e.textContent=o,t.textContent=`Сумма: ${b(s)}`,console.log(o),console.log(s)}function I(){h.addEventListener("click",q),document.querySelector(".form-overlay").classList.remove("form-overlay-view"),document.querySelector(".form-overlay").classList.add("form-overlay-hide"),document.querySelector(".cart-panel").style.overflowY="visible"}k.length>0&&x.classList.add("count-badge--visible"),B(),$.addEventListener("click",(function(e){const t=e.target.closest(".cart-item__info-color");if(t){const e=t.closest(".cart-item"),o=e.dataset.model,s=k.find((e=>e.model===o));if(!s)return;const a=t.textContent.trim().toLowerCase();return e.querySelectorAll(".cart-item__info-color").forEach((e=>e.classList.remove("color--selected"))),t.classList.add("color--selected"),s.selectedColor=a,localStorage.setItem("cart",JSON.stringify(k)),void console.log(`Выбран цвет для ${o}: ${a}`)}const o=e.target.closest(".cart-item__info-size");if(o){const e=o.closest(".cart-item"),t=e.dataset.model,s=k.find((e=>e.model===t));if(!s)return;const a=o.textContent.trim().toLowerCase();return e.querySelectorAll(".cart-item__info-size").forEach((e=>e.classList.remove("size--selected"))),o.classList.add("size--selected"),s.selectedWidth=a,localStorage.setItem("cart",JSON.stringify(k)),void console.log(`Выбран размер для ${t}: ${a}`)}const s=e.target.dataset.model;if(!s)return;const a=k.find((e=>e.model===s));if(!a)return;const n=document.querySelector(`.cart-item[data-model="${s}"]`),c=n.querySelector(".js-qty");if(e.target.classList.contains("btn-remove")){k.splice(k.indexOf(a),1),n?.remove(),localStorage.setItem("cart",JSON.stringify(k));const e=document.querySelector(`.js-add-cart[data-id="${s}"]`);return e&&(e.disabled=!1,e.textContent="добавить",e.classList.remove("ordered")),!k.length>0&&x.classList.remove("count-badge--visible"),void B()}const l=n.querySelector(".js-plus"),i=n.querySelector(".js-minus"),r=void 0===a.limit||isNaN(a.limit);e.target.classList.contains("js-plus")?!r&&a.count<a.limit&&a.count++:e.target.classList.contains("js-minus")&&a.count>1&&a.count--,c&&(c.textContent=`${a.count}`),l.disabled=!r&&a.count>=a.limit,i.disabled=a.count<=1,l.classList.toggle("disabled-btn",l.disabled),i.classList.toggle("disabled-btn",i.disabled),r&&(l.classList.add("disabled-btn",l.disabled),i.classList.add("disabled-btn",i.disabled)),localStorage.setItem("cart",JSON.stringify(k)),B()})),$.addEventListener("click",(function(e){if(e.target.classList.contains("js-customized-set")){const t=e.target.closest(".cart-item"),o=t.querySelector(".cart-item__customized-input"),s=t.querySelector(".cart-item__customized-result");if(o.value=o.value.replace(",","."),console.log(o.value),s.value=o.value,!o.checkValidity())return void o.reportValidity();o.classList.remove("input--error");const a=t.dataset.model,n=k.find((e=>e.model===a));if(!n)return;const c=parseFloat(o.value.trim());s.textContent=c,o.value="",n.customizedValue=c,localStorage.setItem("cart",JSON.stringify(k)),console.log(`Талия обновлена: ${a} — ${c} см`)}})),document.querySelector(".js-clear-all").addEventListener("click",(()=>{localStorage.removeItem("cart"),k.length=0,$.innerHTML="",x.classList.remove("count-badge--visible"),B(),document.querySelectorAll(".js-add-cart").forEach((e=>{e.disabled=!1,e.textContent="добавить",e.classList.remove("ordered")}))})),document.getElementById("openOrderBtn").addEventListener("click",(()=>{const e=JSON.parse(localStorage.getItem("cart")||"[]"),t=document.querySelector(".js-order-warning");if(0===e.length)return t.textContent="Корзина пуста!",setTimeout((function(){t.textContent=""}),2200),void console.log("Корзина пуста!");for(const t of e)if("belt"===t.category){const e=t.customizedValue,o=Number(e);if(!e||isNaN(o)){const e=document.querySelector(`.cart-item[data-model="${t.model}"]`)?.querySelector(".cart-item__customized-input");return void(e?(e.reportValidity(),e.classList.add("input--error")):console.warn(`Поле талии не найдено для модели ${t.model}`))}}h.removeEventListener("click",q),document.querySelector(".form-overlay").classList.add("form-overlay-view"),document.querySelector(".form-overlay").classList.remove("form-overlay-hide"),document.querySelector(".cart-panel").style.overflowY="hidden"})),document.getElementById("closeOrderBtn").addEventListener("click",(()=>{I()}));const z=document.getElementById("orderForm"),N=document.getElementById("phoneInput"),M=document.getElementById("phoneError"),T=document.getElementById("formAgreement");function j(e){t(),document.getElementById("modalMessage").textContent=e,document.querySelector(".cart__dialog-overlay").classList.remove("c-dialog-hide"),document.querySelector(".cart__dialog-overlay").classList.add("c-dialog-view"),I()}T.addEventListener("change",(()=>{T.checked&&T.classList.remove("input--error")})),z.addEventListener("submit",(async e=>{e.preventDefault();const t=N.value.trim();if(M.textContent="",N.classList.remove("input--error"),T.classList.remove("input--error"),!/^\+380\d{9}$/.test(t))return M.textContent="Введите номер в формате +380XXXXXXXXX",N.classList.add("input--error"),void N.focus();if(!T.checked)return T.classList.add("input--error"),void T.focus();console.log(T.checked);const o=JSON.parse(localStorage.getItem("cart"))||[];j("Отправка заказа...");try{const e=new FormData;e.append("phone",t),e.append("cart",JSON.stringify(o));const s=await fetch("/send.php",{method:"POST",body:e}),a=await s.text();s.ok&&"OK"===a.trim()?(j("Заказ отправлен. Мы свяжемся с вами в ближайшее время!"),localStorage.removeItem("cart"),document.getElementById("okBtn").style.display="block"):(j("Ошибка! Не удалось отправить заказ."),document.getElementById("closeModalBtn").style.display="block")}catch(e){j("Ошибка сети. Проверьте соединение."),document.getElementById("closeModalBtn").style.display="block"}})),document.getElementById("closeModalBtn").addEventListener("click",(function(){o(),document.querySelector(".cart__dialog-overlay").classList.remove("c-dialog-view"),document.querySelector(".cart__dialog-overlay").classList.add("c-dialog-hide"),document.getElementById("closeModalBtn").style.display="none",I()})),document.getElementById("okBtn").addEventListener("click",(function(){document.getElementById("phoneInput").value="",o(),document.querySelector(".cart__dialog-overlay").classList.remove("c-dialog-view"),document.querySelector(".cart__dialog-overlay").classList.add("c-dialog-hide"),window.location.reload()})),window.addEventListener("pageshow",(e=>{if(!e.persisted)return;const t=JSON.parse(localStorage.getItem("cart")||"[]");k.length=0,k.push(...t),$.innerHTML="",t.forEach(C),B(),!k.length>0&&x.classList.remove("count-badge--visible"),document.querySelectorAll(".js-add-cart").forEach((e=>{const o=t.some((t=>t.model===e.dataset.id));e.disabled=o,e.textContent=o?"В корзине":"добавить",o||e.classList.remove("ordered")}))}))})();