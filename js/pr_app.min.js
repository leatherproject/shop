(()=>{"use strict";const e=document.getElementsByTagName("body")[0];function t(){e.style.overflowY="hidden"}function o(){e.style.overflowY="visible"}const s=document.querySelector(".social-mobile__base-icon"),c=document.querySelector(".social-mobile"),r=document.querySelectorAll(".social-mobile__link");function n(e){c.contains(e.target)||e.target===s||(r.forEach((e=>e.classList.remove("icons-show"))),s.classList.remove("base-icon-hidden"),document.removeEventListener("click",n))}let a;s.addEventListener("click",(function(e){r.forEach((e=>e.classList.toggle("icons-show"))),s.classList.toggle("base-icon-hidden"),document.addEventListener("click",n)})),function(){const e=document.querySelector(".menu"),s=document.querySelector(".mobile-layer"),c=function(t){const o="0.4s";return e.style.animationDuration=o,s.style.animationDuration=o,window.getComputedStyle(e).getPropertyValue("animation-duration"),400}(),r=document.querySelector(".menu-btn"),n=document.querySelector(".menu-icon");function a(){let t;t=window.setTimeout((function(){e.classList.remove("menu-mobile"),s.classList.remove("mob-layer-off")}),c),r.addEventListener("click",(()=>{clearTimeout(t)}))}r.addEventListener("click",(e=>{!function(){n.classList.toggle("fa-times"),r.classList.add("stop-propagation");const e=document.querySelector(".menu"),s=n.classList.contains("fa-times"),c=document.querySelector(".mobile-layer");1==s?(e.classList.add("menu-mobile"),c.classList.add("mob-layer-on"),c.classList.remove("mob-layer-off"),t(),e.classList.add("menu-visible"),e.classList.remove("menu-hidden")):0==s&&(c.classList.add("mob-layer-off"),c.classList.remove("mob-layer-on"),o(),e.classList.remove("menu-visible"),e.classList.add("menu-hidden"),a()),document.addEventListener("click",(t=>{document.querySelector(".menu-btn");const s=t.target.classList.contains("stop-propagation"),r=document.querySelector(".menu-mobile"),i=n.classList.contains("fa-times");t.target.className,0!=s||1!=i||r.contains(t.target)||(n.classList.remove("fa-times"),c.classList.add("mob-layer-off"),c.classList.remove("mob-layer-on"),o(),e.classList.remove("menu-visible"),e.classList.add("menu-hidden"),a())}))}(),e.stopPropagation()}))}(),function(){const e=document.querySelector(".header"),t=document.querySelector(".social-mobile");let o=0;function s(){let s=window.pageYOffset;o>s?(e&&e.classList.remove("header--scroll"),0===s&&e&&e.classList.remove("header-scroll-bg"),t&&t.classList.remove("social-mob--scroll")):o<s&&(e&&e.classList.add("header--scroll"),t&&t.classList.add("social-mob--scroll"),s>0&&e&&e.classList.add("header-scroll-bg")),o=s}try{s(),window.onscroll=s}catch(e){console.error("Error initializing scrollingX:",e)}}(),window.addEventListener("DOMContentLoaded",(()=>{a=new Swiper(".swiper",{pagination:{el:".swiper-pagination",clickable:!0},navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"}})})),window.colorMap={чёрный:"#000000",черный:"#000000","чёрный/охра":"#000000",коричневый:"#8B4513","коричневый/коньяк":"#8B4513",белый:"#FFFFFF",бежевый:"#F5F5DC","бордово-коричневый":"#8B3A3A",шоколадный:"#442D25","светло-коричневый":"#8c624a","тёмно-коричневый":"#472b1d",коньяк:"#b06010","коньяк/бежевый":"#b06010","серо-оливковый":"#A2B17D",рыжий:"#FF7518",песочный:"#dbb684",охра:"#9b562c","тёмно-каштановый":"#552F26",вишнёвый:"#9c0327",бордовый:"#751634","тёмно-бордовый":"#541026",синий:"#0000FF",зелёный:"#008000",серый:"#808080"};const i=document.querySelector(".products-flex-container"),l=(document.getElementById("modal-container"),window.AppConfig.API_URL);let d=[];!async function(e){try{i.innerHTML='<p class="loading">Loading...</p>';const o=await fetch(e,{cache:"no-cache"});if(!o.ok)throw new Error("500 Internal Server Error");let s;try{s=await o.json()}catch(e){throw console.error("JSON parse error:",e),new Error("500 Internal Server Error")}i.innerHTML="",d=(s.data||[]).filter((e=>"ourProducts"===e.page&&"products"===e.type)),d&&d.length>0?(function(e){const o=document.querySelector(".js-mark");let s=0;e.forEach(((e,c)=>{const r=e.price?Number(e.price):0,n=void 0===e.price||null===e.price?"_":p(r),l=document.createElement("div");l.classList.add("card"),l.innerHTML=`\n      <span class="card__mark">new</span>\n      <img src="${e.preview}" class="card__image" alt="${e.name}">     \n      <h3 class="card__subtitle">${e.name}</h3>\n      <p class="card__price">${n}</p>\n      <p class="card__info-text">${e.description}</p>\n        <div class="card__info card__info--top">\n          <p class="card__info-type">Цвета</p>\n          <div class="card__parameters card__parameters--colors-box">\n            <span class="card__info-color">${e.color1}</span> \n            <span class="card__info-color">${e.color2}</span> \n            <span class="card__info-color">${e.color3}</span> \n            <span class="card__info-color">${e.color4}</span>\n          </div>\n        </div>  \n        <div class="card__info">        \n          <p class="card__info-size">Размеры:</p><span class="card__info-size">${e.size}</span>      \n        </div> \n        <div class="card__info">        \n          <p class="card__info-model">Модель:</p><span class="card__info-model">${e.model}</span>      \n        </div>\n        <div class="card__info card__info--bottom">        \n          <p class="card__info-model">Доступно:</p><span class="card__info-model limit"></span>      \n        </div>\n      <button class="card__add-btn js-add-cart" data-id="${e.model}">добавить</button>\n    `;const d=window.colorMap||{};l.querySelectorAll(".card__info-color").forEach((e=>{const t=e.textContent.trim().toLowerCase(),o=d[t];o?(e.style.backgroundColor=o,e.textContent=t):(e.classList.add("card__info-color--undefined"),e.textContent="")})),void 0===e.limit||isNaN(e.limit)?l.querySelector(".limit").classList.add("fas","fa-question-circle"):l.querySelector(".limit").textContent=`${e.limit}`;const _=l.querySelector(".card__mark");e.new&&(_.classList.add("is-visible"),o.classList.add("is-visible"),s++);const v=l.querySelector(".card__image");v.onerror=function(){this.src="img/preview/image-not-found-v-bg.png",this.alt="Изображение не найдено",console.warn(`Не удалось загрузить изображение: ${e.preview}`)},v.addEventListener("click",(()=>function(e){const o=(Array.isArray(e.imageModal)?e.imageModal:e.imageModal?e.imageModal.split(",").map((e=>e.trim())):[]).map((t=>`\n    <div class="swiper-slide slide slide--xSwiper">\n      <img class="slide__img slide__img--xSwiper" src="${t}" loading="lazy" alt="${e.name}">\n    </div>\n  `)).join("");u.innerHTML=o,a&&(a.update(),a.slideTo(0,0)),m.classList.add("modal-view"),m.classList.remove("modal-hide"),t()}(e))),i.appendChild(l)})),console.log(`Новых товаров: ${s}`),s>0&&(o.textContent=`${s} new`)}(d),function(){const e=JSON.parse(localStorage.getItem("cart")||"[]");document.querySelectorAll(".js-add-cart").forEach((t=>{const o=t.dataset.id;e.some((e=>e.model===o))&&(t.disabled=!0,t.textContent="В корзине",t.classList.add("ordered"))}))}()):i.innerHTML='<p class="not-found">Товары не найдены</p>'}catch(e){console.error("Fetch error:",e),i.innerHTML=`<p class="error-500">${e.message}</p>`}}(l),document.addEventListener("click",(function(e){if(e.target.classList.contains("js-add-cart")){const t=e.target.closest(".card");if(!t)return;const o=e.target.dataset.id||t.dataset.id,s=d.find((e=>e.model===o));if(!s)return void console.warn(`Товар с model "${o}" не найден в JSON`);const c="belt"===s.category;let r;console.log(c),r=c?{model:o,name:t.querySelector(".card__subtitle")?.textContent,price:s.price,preview:t.querySelector(".card__image")?.src,description:t.querySelector(".card__info-text")?.textContent,color1:t.querySelector(".card__info-color:nth-child(1)")?.textContent?.trim(),color2:t.querySelector(".card__info-color:nth-child(2)")?.textContent?.trim(),color3:t.querySelector(".card__info-color:nth-child(3)")?.textContent?.trim(),color4:t.querySelector(".card__info-color:nth-child(4)")?.textContent?.trim(),size:t.querySelector(".card__info-size:last-child")?.textContent,width1:s.width1,width2:s.width2,width3:s.width3,width4:s.width4,count:1,limit:s.limit,category:s.category,selectedColor:t.querySelector(".card__info-color:nth-child(1)")?.textContent?.trim(),selectedWidth:s.width1,customizedValue:""}:{model:o,name:t.querySelector(".card__subtitle")?.textContent,price:s.price,preview:t.querySelector(".card__image")?.src,description:t.querySelector(".card__info-text")?.textContent,color1:t.querySelector(".card__info-color:nth-child(1)")?.textContent?.trim(),color2:t.querySelector(".card__info-color:nth-child(2)")?.textContent?.trim(),color3:t.querySelector(".card__info-color:nth-child(3)")?.textContent?.trim(),color4:t.querySelector(".card__info-color:nth-child(4)")?.textContent?.trim(),size:t.querySelector(".card__info-size:last-child")?.textContent,count:1,limit:s.limit,category:s.category,selectedColor:t.querySelector(".card__info-color:nth-child(1)")?.textContent?.trim()},console.log(r.model,r.price,typeof r.price);const n=S.find((e=>e.model===r.model));if(document.querySelector(".count-badge").classList.add("count-badge--visible"),n){n.count+=1;const t=document.querySelector(`.cart-item[data-model="${r.model}"]`)?.querySelector(".js-qty");t&&(t.textContent=`Qty: ${n.count}`),e.target.disabled=!0,e.target.textContent="В корзине",e.target.classList.add("ordered")}else S.push(r),L(r),w(),e.target.disabled=!0,e.target.textContent="В корзине",e.target.classList.add("ordered");localStorage.setItem("cart",JSON.stringify(S))}}));const m=document.querySelector("#modal-container .modal"),u=m.querySelector(".swiper-wrapper");function p(e){const t="string"==typeof e?parseFloat(e.replace(/[^\d.,]/g,"").replace(",",".")):e;return new Intl.NumberFormat("uk-UA",{style:"currency",currency:"UAH",minimumFractionDigits:0,maximumFractionDigits:2}).format(t)}m.querySelector(".close").addEventListener("click",(()=>{m.classList.add("modal-hide"),m.classList.remove("modal-view"),o()})),m.addEventListener("click",(e=>{e.target===m&&(m.classList.remove("modal-view"),m.classList.add("modal-hide"),o())}));const _=document.querySelector(".cart-btn"),v=document.getElementById("cartOverlay"),f=document.querySelector(".cart-panel__close-btn"),y=document.querySelector(".cart-panel");function g(){y.classList.remove("cart-visible"),v.classList.remove("cart-overlay-view"),v.classList.add("cart-overlay-hide"),o()}function L(e){const t=document.createElement("div");t.className="cart-item",t.dataset.model=e.model;const o=e.price?Number(e.price):0,s=void 0===e.price||null===e.price?"_":p(o);t.innerHTML=`\n    <button class="btn-remove fas fa-trash-alt" data-model="${e.model}"></button>\n    <img class="preview" src="${e.preview}" alt="${e.name}">\n    <p class="model">${e.model}</p>\n    <p class="name">${e.name}</p>\n    <p class="price">${s}</p>\n    <p class="cart-item__info-type">Количество</p>\n    <div class="cart-item__controls">\n      <button class="cart-item__minus-btn js-minus" data-model="${e.model}">&minus;</button>\n      <span class="cart-item__qty js-qty">${e.count}</span>\n      <button class="cart-item__plus-btn js-plus" data-model="${e.model}">&plus;</button>\n    </div>\n    <div class="cart-item__option-colors">\n      <p class="cart-item__info-type">Colors</p>\n      <div class="cart-item__option-wrapper cart-item__option-wrapper--colors">\n        <span class="cart-item__info-color">${e.color1}</span> \n        <span class="cart-item__info-color">${e.color2}</span> \n        <span class="cart-item__info-color">${e.color3}</span> \n        <span class="cart-item__info-color">${e.color4}</span> \n      </div>\n    </div>\n    <div class="cart-item__option-size">\n      <p class="cart-item__info-type">Ширина ремня</p>\n      <div class="cart-item__option-wrapper cart-item__option-wrapper--size">\n        <span class="cart-item__info-size">${e.width1}</span> \n        <span class="cart-item__info-size">${e.width2}</span> \n        <span class="cart-item__info-size">${e.width3}</span> \n        <span class="cart-item__info-size">${e.width4}</span> \n      </div>\n    </div>\n    <div class="cart-item__option-customized">\n      <label class="cart-item__customized-label" for="waist">Обхват талии (см)\n        <span class="cart-item__customized-result"></span>\n      </label>\n      <input class="cart-item__customized-input" type="number" step="0.1" id="waist" name="waist" min="30" max="200" required>\n      <button class="cart-item__customized-btn js-customized-set">ok</button>\n    </div>\n  `,document.querySelector(".js-cart").appendChild(t);const c=window.colorMap||{};t.querySelectorAll(".cart-item__info-color").forEach((t=>{const o=t.textContent.trim().toLowerCase(),s=c[o];s?(t.style.backgroundColor=s,t.textContent=o):(t.classList.add("cart-item__info-color--undefined"),t.textContent=""),e.selectedColor&&e.selectedColor.toLowerCase()===o&&t.classList.add("color--selected")}));const r="belt"===e.category;console.log(r,e.category);const n=t.querySelector(".cart-item__option-size");r||n.classList.add("cart-item__option-size--hidden"),t.querySelectorAll(".cart-item__info-size").forEach((t=>{const o=t.textContent.trim().toLowerCase();"undefined"!==o?t.textContent=o:t.classList.add("cart-item__info-size--undefined"),e.selectedWidth&&e.selectedWidth.toLowerCase()===o&&t.classList.add("size--selected")}));const a=t.querySelector(".cart-item__customized-result"),i=t.querySelector(".cart-item__option-customized");console.log(r,e.category),r?a.textContent=e.customizedValue||"":i.classList.add("cart-item__option-customized--undefined");const l=t.querySelector(".js-plus"),d=t.querySelector(".js-minus"),m=void 0===e.limit||isNaN(e.limit);1===e.limit&&(l.disabled=!0,d.disabled=!0,l.classList.add("disabled-btn"),d.classList.add("disabled-btn")),e.count===e.limit&&(l.disabled=!0,l.classList.add("disabled-btn")),m&&(l.disabled=!0,d.disabled=!0,l.classList.add("disabled-btn"),d.classList.add("disabled-btn"))}_.addEventListener("click",(()=>{y.classList.toggle("cart-visible")?(v.classList.remove("cart-overlay-hide"),v.classList.add("cart-overlay-view"),t()):(v.classList.remove("cart-overlay-view"),v.classList.add("cart-overlay-hide"),o())})),v.addEventListener("click",g),f.addEventListener("click",g);const b=document.querySelector(".js-cart"),S=JSON.parse(localStorage.getItem("cart")||"[]");console.log(S),S.forEach(L),w();const h=document.querySelector(".count-badge");function w(){const e=document.querySelector(".cart-icon__count"),t=document.querySelector(".price-total");let o=0,s=0;S.forEach((e=>{const t=e.price?Number(e.price):0;o+=e.count,s+=e.count*t})),e.textContent=o,t.textContent=`Сумма: ${p(s)}`,console.log(o),console.log(s)}function q(){v.addEventListener("click",g),document.querySelector(".form-overlay").classList.remove("form-overlay-view"),document.querySelector(".form-overlay").classList.add("form-overlay-hide"),document.querySelector(".cart-panel").style.overflowY="visible"}S.length>0&&h.classList.add("count-badge--visible"),w(),b.addEventListener("click",(function(e){const t=e.target.closest(".cart-item__info-color");if(t){const e=t.closest(".cart-item"),o=e.dataset.model,s=S.find((e=>e.model===o));if(!s)return;const c=t.textContent.trim().toLowerCase();return e.querySelectorAll(".cart-item__info-color").forEach((e=>e.classList.remove("color--selected"))),t.classList.add("color--selected"),s.selectedColor=c,localStorage.setItem("cart",JSON.stringify(S)),void console.log(`Выбран цвет для ${o}: ${c}`)}const o=e.target.closest(".cart-item__info-size");if(o){const e=o.closest(".cart-item"),t=e.dataset.model,s=S.find((e=>e.model===t));if(!s)return;const c=o.textContent.trim().toLowerCase();return e.querySelectorAll(".cart-item__info-size").forEach((e=>e.classList.remove("size--selected"))),o.classList.add("size--selected"),s.selectedWidth=c,localStorage.setItem("cart",JSON.stringify(S)),void console.log(`Выбран размер для ${t}: ${c}`)}const s=e.target.dataset.model;if(!s)return;const c=S.find((e=>e.model===s));if(!c)return;const r=document.querySelector(`.cart-item[data-model="${s}"]`),n=r.querySelector(".js-qty");if(e.target.classList.contains("btn-remove")){S.splice(S.indexOf(c),1),r?.remove(),localStorage.setItem("cart",JSON.stringify(S));const e=document.querySelector(`.js-add-cart[data-id="${s}"]`);return e&&(e.disabled=!1,e.textContent="добавить",e.classList.remove("ordered")),!S.length>0&&h.classList.remove("count-badge--visible"),void w()}const a=r.querySelector(".js-plus"),i=r.querySelector(".js-minus"),l=void 0===c.limit||isNaN(c.limit);e.target.classList.contains("js-plus")?!l&&c.count<c.limit&&c.count++:e.target.classList.contains("js-minus")&&c.count>1&&c.count--,n&&(n.textContent=`${c.count}`),a.disabled=!l&&c.count>=c.limit,i.disabled=c.count<=1,a.classList.toggle("disabled-btn",a.disabled),i.classList.toggle("disabled-btn",i.disabled),l&&(a.classList.add("disabled-btn",a.disabled),i.classList.add("disabled-btn",i.disabled)),localStorage.setItem("cart",JSON.stringify(S)),w()})),b.addEventListener("click",(function(e){if(e.target.classList.contains("js-customized-set")){const t=e.target.closest(".cart-item"),o=t.querySelector(".cart-item__customized-input"),s=t.querySelector(".cart-item__customized-result");if(o.value=o.value.replace(",","."),console.log(o.value),s.value=o.value,!o.checkValidity())return void o.reportValidity();o.classList.remove("input--error");const c=t.dataset.model,r=S.find((e=>e.model===c));if(!r)return;const n=parseFloat(o.value.trim());s.textContent=n,o.value="",r.customizedValue=n,localStorage.setItem("cart",JSON.stringify(S)),console.log(`Талия обновлена: ${c} — ${n} см`)}})),document.querySelector(".js-clear-all").addEventListener("click",(()=>{localStorage.removeItem("cart"),S.length=0,b.innerHTML="",h.classList.remove("count-badge--visible"),w(),document.querySelectorAll(".js-add-cart").forEach((e=>{e.disabled=!1,e.textContent="добавить",e.classList.remove("ordered")}))})),document.getElementById("openOrderBtn").addEventListener("click",(()=>{const e=JSON.parse(localStorage.getItem("cart")||"[]"),t=document.querySelector(".js-order-warning");if(0===e.length)return t.textContent="Корзина пуста!",setTimeout((function(){t.textContent=""}),2200),void console.log("Корзина пуста!");for(const t of e)if("belt"===t.category){const e=t.customizedValue,o=Number(e);if(!e||isNaN(o)){const e=document.querySelector(`.cart-item[data-model="${t.model}"]`)?.querySelector(".cart-item__customized-input");return void(e?(e.reportValidity(),e.classList.add("input--error")):console.warn(`Поле талии не найдено для модели ${t.model}`))}}v.removeEventListener("click",g),document.querySelector(".form-overlay").classList.add("form-overlay-view"),document.querySelector(".form-overlay").classList.remove("form-overlay-hide"),document.querySelector(".cart-panel").style.overflowY="hidden"})),document.getElementById("closeOrderBtn").addEventListener("click",(()=>{q()}));const C=document.getElementById("orderForm"),x=document.getElementById("phoneInput"),E=document.getElementById("phoneError"),$=document.getElementById("formAgreement");$.addEventListener("change",(()=>{$.checked&&$.classList.remove("input--error")})),C.addEventListener("submit",(e=>{e.preventDefault();const o=x.value.trim();if(E.textContent="",x.classList.remove("input--error"),$.classList.remove("input--error"),!/^\+380\d{9}$/.test(o))return E.textContent="Введите номер в формате +380XXXXXXXXX",x.classList.add("input--error"),void x.focus();if(!$.checked)return $.classList.add("input--error"),void $.focus();console.log($.checked);const s=JSON.parse(localStorage.getItem("cart"))||[];document.getElementById("modalMessage").textContent="Отправка заказа...",document.querySelector(".cart__dialog-overlay").classList.remove("c-dialog-hide"),document.querySelector(".cart__dialog-overlay").classList.add("c-dialog-view"),t(),C.phone.value=o,C.cart.value=JSON.stringify(s),C.secret.value="k5Dvofjh5670OjhHqErg490dbd54hHkjkdfOo0m",C.action="https://script.google.com/macros/s/AKfycbxGN7S7JmP9vdKdJM1SQX1UppTjLhTTQl3a8_xW3zMxN_KcSf-UgpOZp0fNU3jJCmQ7/exec",C.method="POST",C.target="hidden_iframe",C.submit()})),document.getElementById("hidden_iframe").addEventListener("load",(()=>{console.log("Ответ от GAS получен — очищаем интерфейс"),localStorage.removeItem("cart"),S.length=0,b.innerHTML="",h.classList.remove("count-badge--visible"),w(),document.querySelectorAll(".js-add-cart").forEach((e=>{e.disabled=!1,e.textContent="добавить",e.classList.remove("ordered")})),x.value="",o(),document.querySelector(".cart__dialog-overlay").classList.remove("c-dialog-view"),document.querySelector(".cart__dialog-overlay").classList.add("c-dialog-hide"),q()})),window.addEventListener("pageshow",(e=>{if(!e.persisted)return;const t=JSON.parse(localStorage.getItem("cart")||"[]");S.length=0,S.push(...t),b.innerHTML="",t.forEach(L),w(),!S.length>0&&h.classList.remove("count-badge--visible"),document.querySelectorAll(".js-add-cart").forEach((e=>{const o=t.some((t=>t.model===e.dataset.id));e.disabled=o,e.textContent=o?"В корзине":"добавить",o||e.classList.remove("ordered")}))}))})();