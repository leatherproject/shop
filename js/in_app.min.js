(()=>{"use strict";const e=document.getElementsByTagName("body")[0];function t(){e.style.overflowY="hidden"}function o(){e.style.overflowY="visible"}const s=document.querySelector(".social-mobile__base-icon"),r=document.querySelector(".social-mobile"),c=document.querySelectorAll(".social-mobile__link");function a(e){r.contains(e.target)||e.target===s||(c.forEach((e=>e.classList.remove("icons-show"))),s.classList.remove("base-icon-hidden"),document.removeEventListener("click",a))}s.addEventListener("click",(function(e){c.forEach((e=>e.classList.toggle("icons-show"))),s.classList.toggle("base-icon-hidden"),document.addEventListener("click",a)})),function(){const e=document.querySelector(".menu"),s=document.querySelector(".mobile-layer"),r=function(t){const o="0.4s";return e.style.animationDuration=o,s.style.animationDuration=o,window.getComputedStyle(e).getPropertyValue("animation-duration"),400}(),c=document.querySelector(".menu-btn"),a=document.querySelector(".menu-icon");function n(){let t;t=window.setTimeout((function(){e.classList.remove("menu-mobile"),s.classList.remove("mob-layer-off")}),r),c.addEventListener("click",(()=>{clearTimeout(t)}))}c.addEventListener("click",(e=>{!function(){a.classList.toggle("fa-times"),c.classList.add("stop-propagation");const e=document.querySelector(".menu"),s=a.classList.contains("fa-times"),r=document.querySelector(".mobile-layer");1==s?(e.classList.add("menu-mobile"),r.classList.add("mob-layer-on"),r.classList.remove("mob-layer-off"),t(),e.classList.add("menu-visible"),e.classList.remove("menu-hidden")):0==s&&(r.classList.add("mob-layer-off"),r.classList.remove("mob-layer-on"),o(),e.classList.remove("menu-visible"),e.classList.add("menu-hidden"),n()),document.addEventListener("click",(t=>{document.querySelector(".menu-btn");const s=t.target.classList.contains("stop-propagation"),c=document.querySelector(".menu-mobile"),i=a.classList.contains("fa-times");t.target.className,0!=s||1!=i||c.contains(t.target)||(a.classList.remove("fa-times"),r.classList.add("mob-layer-off"),r.classList.remove("mob-layer-on"),o(),e.classList.remove("menu-visible"),e.classList.add("menu-hidden"),n())}))}(),e.stopPropagation()}))}(),function(){const e=document.querySelector(".header"),t=document.querySelector(".social-mobile");let o=0;function s(){let s=window.pageYOffset;o>s?(e&&e.classList.remove("header--scroll"),0===s&&e&&e.classList.remove("header-scroll-bg"),t&&t.classList.remove("social-mob--scroll")):o<s&&(e&&e.classList.add("header--scroll"),t&&t.classList.add("social-mob--scroll"),s>0&&e&&e.classList.add("header-scroll-bg")),o=s}try{s(),window.onscroll=s}catch(e){console.error("Error initializing scrollingX:",e)}}(),window.colorMap={чёрный:"#000000",черный:"#000000","чёрный/охра":"#000000",коричневый:"#8B4513","коричневый/коньяк":"#8B4513",белый:"#FFFFFF",бежевый:"#F5F5DC","бордово-коричневый":"#8B3A3A",шоколадный:"#442D25","светло-коричневый":"#8c624a","тёмно-коричневый":"#472b1d",коньяк:"#b06010","коньяк/бежевый":"#b06010","серо-оливковый":"#A2B17D",рыжий:"#FF7518",песочный:"#dbb684",охра:"#9b562c","тёмно-каштановый":"#552F26",вишнёвый:"#9c0327",бордовый:"#751634","тёмно-бордовый":"#541026",синий:"#0000FF",зелёный:"#008000",серый:"#808080"};const n=document.querySelector(".article--info"),i=document.querySelector(".article--payment"),l=document.querySelector(".article--privacy"),d=document.querySelector("[data-top-image]"),m=document.querySelector("[data-top-title]"),u=document.querySelector("[data-top-slogan]");function p(e,t){t.forEach((t=>{const o=document.createElement("div");o.classList.add("article__item",`article__item--${t.group}`);let s="";t.image&&(s=`<img class="article__image article__image--${t.group}" src="${t.image}" alt="${t.alt||""}">`);let r="";t.icon&&(r=`<img class="article__icon article__icon--${t.group}" src="${t.icon}">`);let c="",a=[];t.text.split("\n").forEach((e=>{let o=e.trimEnd().replace(/^\s+/,"");o.startsWith("-")?a.push(`<li class="article__list article__list--${t.group}">${o.substring(1).trim()}</li>`):(a.length&&(c+=`<ul class="article__ul article__ul--${t.group}">${a.join("")}</ul>`,a=[]),o&&(c+=`<p class="article__text article__text--${t.group}">${o}</p>`))})),a.length&&(c+=`<ul class="article__ul article__ul--${t.group}">${a.join("")}</ul>`),o.innerHTML=`\n      <div class="article__title-box article__title-box--${t.group}">\n        <h3 class="article__title article__title--${t.group}">${t.title}</h3>\n        ${r}\n      </div>\n      ${s}\n      ${c}\n    `,e.appendChild(o)}))}function g(e){const t="string"==typeof e?parseFloat(e.replace(/[^\d.,]/g,"").replace(",",".")):e;return new Intl.NumberFormat("uk-UA",{style:"currency",currency:"UAH",minimumFractionDigits:0,maximumFractionDigits:2}).format(t)}!async function(e){try{n.innerHTML='<p class="loading">Loading...</p>',i.innerHTML='<p class="loading">Loading...</p>',l.innerHTML='<p class="loading">Loading...</p>';const t=await fetch(e,{cache:"no-cache"});if(!t.ok)throw new Error("500 Internal Server Error");let o;try{o=await t.json()}catch(e){throw console.error("JSON parse error:",e),new Error("500 Internal Server Error")}const s=o.data;console.log("Полученные данные:",s);const r=s.filter((e=>"information"===e.page)).filter((e=>"articles"===e.type)),c=r.filter((e=>"info"===e.group)),a=r.filter((e=>"payment"===e.group)),g=r.filter((e=>"privacy"===e.group)),v=o.data.filter((e=>"ourProducts"===e.page&&!0===e.new));if(v.length>0){const e=document.querySelector(".js-mark");e.classList.add("is-visible"),e.textContent=`${v.length} new`,console.log(`Новых товаров: ${v.length}`)}n.innerHTML="",i.innerHTML="",l.innerHTML="";const f=(o.data||[]).filter((e=>"information"===e.page&&"top"===e.type));d.style.backgroundImage=`url(${f[0].image})`,m.textContent=f[0].title,u.textContent=f[0].slogan,c&&c.length>0?p(n,c):n.innerHTML='<p class="not-found">Нет статей</p>',a&&a.length>0?p(i,a):i.innerHTML='<p class="not-found">Нет статей</p>',g&&g.length>0?p(l,g):l.innerHTML='<p class="not-found">Нет статей</p>'}catch(e){console.error("Fetch error:",e),n.innerHTML=`<p class="error-500">${e.message}</p>`,i.innerHTML=`<p class="error-500">${e.message}</p>`,l.innerHTML=`<p class="error-500">${e.message}</p>`}}(window.AppConfig.API_URL);const v=document.querySelector(".cart-btn"),f=document.getElementById("cartOverlay"),y=document.querySelector(".cart-panel__close-btn"),_=document.querySelector(".cart-panel");function L(){_.classList.remove("cart-visible"),f.classList.remove("cart-overlay-view"),f.classList.add("cart-overlay-hide"),o()}function b(e){const t=document.createElement("div");t.className="cart-item",t.dataset.model=e.model,t.innerHTML=`\n    <button class="btn-remove fas fa-trash-alt" data-model="${e.model}"></button>\n    <img class="preview" src="${e.preview}" alt="${e.name}">\n    <p class="model">${e.model}</p>\n    <p class="name">${e.name}</p>\n    <p class="price">${g(e.price)}</p>\n    <p class="cart-item__info-type">Количество</p>\n    <div class="cart-item__controls">\n      <button class="cart-item__minus-btn js-minus" data-model="${e.model}">&minus;</button>\n      <span class="cart-item__qty js-qty">${e.count}</span>\n      <button class="cart-item__plus-btn js-plus" data-model="${e.model}">&plus;</button>\n    </div>\n    <div class="cart-item__option-colors">\n      <p class="cart-item__info-type">Colors</p>\n      <div class="cart-item__option-wrapper cart-item__option-wrapper--colors">\n        <span class="cart-item__info-color">${e.color1}</span> \n        <span class="cart-item__info-color">${e.color2}</span> \n        <span class="cart-item__info-color">${e.color3}</span> \n        <span class="cart-item__info-color">${e.color4}</span> \n      </div>\n    </div>\n    <div class="cart-item__option-size">\n      <p class="cart-item__info-type">Ширина ремня</p>\n      <div class="cart-item__option-wrapper cart-item__option-wrapper--size">\n        <span class="cart-item__info-size">${e.width1}</span> \n        <span class="cart-item__info-size">${e.width2}</span> \n        <span class="cart-item__info-size">${e.width3}</span> \n        <span class="cart-item__info-size">${e.width4}</span> \n      </div>\n    </div>\n    <div class="cart-item__option-customized">\n      <label class="cart-item__customized-label" for="waist">Обхват талии (см)\n        <span class="cart-item__customized-result"></span>\n      </label>\n      <input class="cart-item__customized-input" type="number" step="0.1" id="waist" name="waist" min="30" max="200" required>\n      <button class="cart-item__customized-btn js-customized-set">ok</button>\n    </div>\n  `,document.querySelector(".js-cart").appendChild(t);const o=window.colorMap||{};t.querySelectorAll(".cart-item__info-color").forEach((t=>{const s=t.textContent.trim().toLowerCase(),r=o[s];r?(t.style.backgroundColor=r,t.textContent=s):(t.classList.add("cart-item__info-color--undefined"),t.textContent=""),e.selectedColor&&e.selectedColor.toLowerCase()===s&&t.classList.add("color--selected")}));const s="belt"===e.category,r=t.querySelector(".cart-item__option-size");s||r.classList.add("cart-item__option-size--hidden"),t.querySelectorAll(".cart-item__info-size").forEach((t=>{const o=t.textContent.trim().toLowerCase();"undefined"!==o?t.textContent=o:t.classList.add("cart-item__info-size--undefined"),e.selectedWidth&&e.selectedWidth.toLowerCase()===o&&t.classList.add("size--selected")}));const c=t.querySelector(".cart-item__customized-result"),a=t.querySelector(".cart-item__option-customized");s?c.textContent=e.customizedValue||"":a.classList.add("cart-item__option-customized--undefined");const n=t.querySelector(".js-plus"),i=t.querySelector(".js-minus"),l=void 0===e.limit||isNaN(e.limit);1===e.limit&&(n.disabled=!0,i.disabled=!0,n.classList.add("disabled-btn"),i.classList.add("disabled-btn")),e.count===e.limit&&(n.disabled=!0,n.classList.add("disabled-btn")),l&&(n.disabled=!0,i.disabled=!0,n.classList.add("disabled-btn"),i.classList.add("disabled-btn"))}v.addEventListener("click",(()=>{_.classList.toggle("cart-visible")?(f.classList.remove("cart-overlay-hide"),f.classList.add("cart-overlay-view"),t()):(f.classList.remove("cart-overlay-view"),f.classList.add("cart-overlay-hide"),o())})),f.addEventListener("click",L),y.addEventListener("click",L);const h=document.querySelector(".js-cart"),S=JSON.parse(localStorage.getItem("cart")||"[]");S.forEach(b),w();const q=document.querySelector(".count-badge");function w(){const e=document.querySelector(".cart-icon__count"),t=document.querySelector(".price-total");let o=0,s=0;S.forEach((e=>{o+=e.count,s+=e.count*e.price})),e.textContent=o,t.textContent=`Сумма: ${g(s)}`}function E(){f.addEventListener("click",L),document.querySelector(".form-overlay").classList.remove("form-overlay-view"),document.querySelector(".form-overlay").classList.add("form-overlay-hide"),document.querySelector(".cart-panel").style.overflowY="visible"}S.length>0&&q.classList.add("count-badge--visible"),w(),h.addEventListener("click",(function(e){const t=e.target.closest(".cart-item__info-color");if(t){const e=t.closest(".cart-item"),o=e.dataset.model,s=S.find((e=>e.model===o));if(!s)return;const r=t.textContent.trim().toLowerCase();return e.querySelectorAll(".cart-item__info-color").forEach((e=>e.classList.remove("color--selected"))),t.classList.add("color--selected"),s.selectedColor=r,void localStorage.setItem("cart",JSON.stringify(S))}const o=e.target.closest(".cart-item__info-size");if(o){const e=o.closest(".cart-item"),t=e.dataset.model,s=S.find((e=>e.model===t));if(!s)return;const r=o.textContent.trim().toLowerCase();return e.querySelectorAll(".cart-item__info-size").forEach((e=>e.classList.remove("size--selected"))),o.classList.add("size--selected"),s.selectedWidth=r,void localStorage.setItem("cart",JSON.stringify(S))}const s=e.target.dataset.model;if(!s)return;const r=S.find((e=>e.model===s));if(!r)return;const c=document.querySelector(`.cart-item[data-model="${s}"]`),a=c.querySelector(".js-qty");if(e.target.classList.contains("btn-remove")){S.splice(S.indexOf(r),1),c?.remove(),localStorage.setItem("cart",JSON.stringify(S));const e=document.querySelector(`.js-add-cart[data-id="${s}"]`);return e&&(e.disabled=!1,e.textContent="добавить",e.classList.remove("ordered")),!S.length>0&&q.classList.remove("count-badge--visible"),void w()}const n=c.querySelector(".js-plus"),i=c.querySelector(".js-minus"),l=void 0===r.limit||isNaN(r.limit);e.target.classList.contains("js-plus")?!l&&r.count<r.limit&&r.count++:e.target.classList.contains("js-minus")&&r.count>1&&r.count--,a&&(a.textContent=`${r.count}`),n.disabled=!l&&r.count>=r.limit,i.disabled=r.count<=1,n.classList.toggle("disabled-btn",n.disabled),i.classList.toggle("disabled-btn",i.disabled),l&&(n.classList.add("disabled-btn",n.disabled),i.classList.add("disabled-btn",i.disabled)),localStorage.setItem("cart",JSON.stringify(S)),w()})),h.addEventListener("click",(function(e){if(e.target.classList.contains("js-customized-set")){const t=e.target.closest(".cart-item"),o=t.querySelector(".cart-item__customized-input"),s=t.querySelector(".cart-item__customized-result");if(o.value=o.value.replace(",","."),s.value=o.value,!o.checkValidity())return void o.reportValidity();o.classList.remove("input--error");const r=t.dataset.model,c=S.find((e=>e.model===r));if(!c)return;const a=parseFloat(o.value.trim());s.textContent=a,o.value="",c.customizedValue=a,localStorage.setItem("cart",JSON.stringify(S))}})),document.querySelector(".js-clear-all").addEventListener("click",(()=>{localStorage.removeItem("cart"),S.length=0,h.innerHTML="",q.classList.remove("count-badge--visible"),w(),document.querySelectorAll(".js-add-cart").forEach((e=>{e.disabled=!1,e.textContent="добавить",e.classList.remove("ordered")}))})),document.getElementById("openOrderBtn").addEventListener("click",(()=>{const e=JSON.parse(localStorage.getItem("cart")||"[]"),t=document.querySelector(".js-order-warning");if(0===e.length)return t.textContent="Корзина пуста!",void setTimeout((function(){t.textContent=""}),2200);for(const t of e)if("belt"===t.category){const e=t.customizedValue,o=Number(e);if(!e||isNaN(o)){const e=document.querySelector(`.cart-item[data-model="${t.model}"]`)?.querySelector(".cart-item__customized-input");return void(e?(e.reportValidity(),e.classList.add("input--error")):console.warn(`Поле талии не найдено для модели ${t.model}`))}}f.removeEventListener("click",L),document.querySelector(".form-overlay").classList.add("form-overlay-view"),document.querySelector(".form-overlay").classList.remove("form-overlay-hide"),document.querySelector(".cart-panel").style.overflowY="hidden"})),document.getElementById("closeOrderBtn").addEventListener("click",(()=>{E()}));const $=document.getElementById("orderForm"),C=document.getElementById("phoneInput"),x=document.getElementById("phoneError"),z=document.getElementById("formAgreement");z.addEventListener("change",(()=>{z.checked&&z.classList.remove("input--error")})),$.addEventListener("submit",(e=>{e.preventDefault();const o=C.value.trim();if(x.textContent="",C.classList.remove("input--error"),z.classList.remove("input--error"),!/^\+380\d{9}$/.test(o))return x.textContent="Введите номер в формате +380XXXXXXXXX",C.classList.add("input--error"),void C.focus();if(!z.checked)return z.classList.add("input--error"),void z.focus();const s=JSON.parse(localStorage.getItem("cart"))||[];document.getElementById("modalMessage").textContent="Отправка заказа...",document.querySelector(".cart__dialog-overlay").classList.remove("c-dialog-hide"),document.querySelector(".cart__dialog-overlay").classList.add("c-dialog-view"),t(),$.phone.value=o,$.cart.value=JSON.stringify(s),$.secret.value="k5Dvofjh5670OjhHqErg490dbd54hHkjkdfOo0m",$.action="https://script.google.com/macros/s/AKfycbwDRQn2kc9IH5Kour4Do2lSMqMlwEBQzxjuOMGjir1XIrtCvAcoBn0M27qMoL3xuQ/exec",$.method="POST",$.target="hidden_iframe",$.submit()})),document.getElementById("hidden_iframe").addEventListener("load",(()=>{localStorage.removeItem("cart"),S.length=0,h.innerHTML="",q.classList.remove("count-badge--visible"),w(),document.querySelectorAll(".js-add-cart").forEach((e=>{e.disabled=!1,e.textContent="добавить",e.classList.remove("ordered")})),C.value="",o(),document.querySelector(".cart__dialog-overlay").classList.remove("c-dialog-view"),document.querySelector(".cart__dialog-overlay").classList.add("c-dialog-hide"),E()})),window.addEventListener("pageshow",(e=>{if(!e.persisted)return;const t=JSON.parse(localStorage.getItem("cart")||"[]");S.length=0,S.push(...t),h.innerHTML="",t.forEach(b),w(),!S.length>0&&q.classList.remove("count-badge--visible"),document.querySelectorAll(".js-add-cart").forEach((e=>{const o=t.some((t=>t.model===e.dataset.id));e.disabled=o,e.textContent=o?"В корзине":"добавить",o||e.classList.remove("ordered")}))}))})();