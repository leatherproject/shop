
        
        
        name: Sync Google Drive JSON

# Разрешает запуск по расписанию и вручную
on:
  schedule:
    - cron: '12 11 * * *' 
  workflow_dispatch:

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Download JSON from Google Drive and Validate
      run: |
        DRIVE_ID="1aYWqdRjy6q9rIM_QlwgoTfGr8yUpIcPH"
        DOWNLOAD_URL="https://drive.google.com/uc?export=download&id=1aYWqdRjy6q9rIM_QlwgoTfGr8yUpIcPH"
        OUTPUT_PATH="data/data.json"
        
        echo "Attempting to download file from Google Drive..."
        
        # Агрессивный curl для обхода перенаправлений Google
        curl -L -c /tmp/cookies.txt "$DOWNLOAD_URL" -o "$OUTPUT_PATH"
        
        # Проверка размера скачанного файла
        FILE_SIZE=$(wc -c < "$OUTPUT_PATH")
        echo "::notice::Downloaded file size: $FILE_SIZE bytes."
        
        # Если скачанный файл слишком мал (вероятно, HTML-ошибка), останавливаем Action
        if [ $FILE_SIZE -lt 500 ]; then
          echo "::error::Downloaded file is suspiciously small ($FILE_SIZE bytes). Google Drive likely returned an error page."
          exit 1 
        fi

    - name: Commit and Push if file changed
      # ИСПРАВЛЕНИЕ: Используем версию v4, которая корректно работает с параметром 'files'
      uses: stefanzweifel/git-auto-commit-action@v4 
      with:
        files: data/data.json # <-- ИСПОЛЬЗУЕМ 'files'
        commit_message: "Automated: Update data.json from Google Drive"
        commit_user_name: GitHub Actions Bot
        commit_user_email: actions@github.com
